version: 1
frontend:
  phases:
    preBuild:
      commands:
        # Write environment variables to .env.production
        - env >> .env.production
        # Use corepack (built-in, faster than npm install)
        - corepack enable
        - corepack prepare pnpm@latest --activate

        # Configure pnpm for speed
        - pnpm config set store-dir .pnpm-store
        - pnpm config set package-import-method copy
        # Install ALL dependencies (devDeps needed for build, standalone handles runtime)
        - pnpm install --frozen-lockfile --prefer-offline
    build:
      commands:
        # Build with standalone output (configured in next.config.ts)
        - pnpm run build
  artifacts:
    # Use standalone output directory (much smaller!)
    baseDirectory: .next
    files:
      - '**/*'
  cache:
    paths:
      # Cache Next.js build cache (most important!)
      - .next/cache/**/*
      # Cache pnpm local store
      - .pnpm-store/**/*
      # Cache node_modules (for faster future builds)
      - node_modules/**/*
